{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Richman - ì‹œì¥ ê°ì„± ë¶„ì„</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <style>
        /* ì´ í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ */
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .result-box {
            margin-top: 30px;
            padding: 20px;
            border-radius: 10px;
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            display: none; /* ì²˜ìŒì—” ìˆ¨ê¹€ */
        }

        /* ê²°ê³¼ ë¼ë²¨ ìƒ‰ìƒ */
        .positive { color: #28a745; font-weight: bold; font-size: 1.2em; }
        .negative { color: #dc3545; font-weight: bold; font-size: 1.2em; }
        .neutral { color: #6c757d; font-weight: bold; font-size: 1.2em; }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #666;
            text-decoration: none;
            font-size: 0.9em;
        }
        .back-link:hover { color: #007bff; }
    </style>
</head>
<body>

    <a href="{% url 'richman:main' %}" class="back-link">â† ë©”ì¸ ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</a>

    <div class="container">
        <h1>ğŸ“ˆ ì‹œì¥ ê°ì„± ë¶„ì„ (FinBERT)</h1>
        <p>ê¸€ë¡œë²Œ ê¸ˆìœµ ë‰´ìŠ¤ë¥¼ ì…ë ¥í•˜ë©´ AIê°€ ì‹œì¥ì— ë¯¸ì¹  ì˜í–¥(í˜¸ì¬/ì•…ì¬)ì„ ë¶„ì„í•©ë‹ˆë‹¤.</p><br>
        <p>[model : ProsusAI/finbert]</p>

        <div>
            <textarea id="newsText" placeholder="ì—¬ê¸°ì— ì˜ì–´ ê¸ˆìœµ ë‰´ìŠ¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”...&#10;ì˜ˆì‹œ: Bitcoin crashes below $30k amid regulatory concerns."></textarea>
            <br>
            <button onclick="analyzeNews()" class="primary-btn">ë¶„ì„ ì‹œì‘ ğŸš€</button>
        </div>

        <div id="result-box" class="result-box">
            <h3>ë¶„ì„ ê²°ê³¼: <span id="labelResult"></span></h3>
            <p>AI í™•ì‹ ë„: <span id="scoreResult"></span>%</p>
            <hr style="border: 0; border-top: 1px solid #eee; margin: 15px 0;">
            <p style="font-size: 0.9em; color: #888;">ì…ë ¥ëœ ë‰´ìŠ¤:<br><span id="originalText" style="font-style: italic;"></span></p>
        </div>
    </div>

    <script>
        async function analyzeNews() {
            const text = document.getElementById('newsText').value;
            const resultBox = document.getElementById('result-box');
            const btn = document.querySelector('button');

            if (!text.trim()) { alert("ë‰´ìŠ¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }

            // ë¡œë”© í‘œì‹œ
            btn.innerText = "ë¶„ì„ ì¤‘... â³";
            btn.disabled = true;

            try {
                // Django Urlsì— ì •ì˜ëœ 'richman:analyze' ì£¼ì†Œë¡œ ìš”ì²­
                const response = await fetch("{% url 'richman:analyze' %}", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-CSRFToken': '{{ csrf_token }}', // ì¥ê³  ë³´ì•ˆ í† í°
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: `text=${encodeURIComponent(text)}`
                });

                if (!response.ok) throw new Error("ì„œë²„ ì˜¤ë¥˜ ë°œìƒ");

                const data = await response.json();

                // ê²°ê³¼ ì—…ë°ì´íŠ¸
                const labelSpan = document.getElementById('labelResult');
                labelSpan.innerText = data.korean_label;
                labelSpan.className = data.label; // CSS í´ë˜ìŠ¤ ì ìš© (ìƒ‰ìƒ ë³€ê²½)

                document.getElementById('scoreResult').innerText = data.score;
                document.getElementById('originalText').innerText = data.original_text;

                // ê²°ê³¼ì°½ ë³´ì´ê¸°
                resultBox.style.display = 'block';

            } catch (error) {
                console.error('Error:', error);
                alert("ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì¼œì ¸ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.");
            } finally {
                // ë²„íŠ¼ ì›ìƒë³µêµ¬
                btn.innerText = "ë¶„ì„ ì‹œì‘ ğŸš€";
                btn.disabled = false;
            }
        }
    </script>

</body>
</html>