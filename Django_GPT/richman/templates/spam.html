{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Richman - ìŠ¤íŒ¸/í”¼ì‹± íƒì§€</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>

    <a href="{% url 'richman:main' %}" class="back-link">â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>

    <div class="page-container">
        <h1>ğŸ›¡ï¸ ìŠ¤íŒ¸ ë° í”¼ì‹± íƒì§€</h1>
        <p>ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ë¬¸ìë‚˜ ì´ë©”ì¼ ë‚´ìš©ì„ ì…ë ¥í•˜ë©´ <b>ìŠ¤íŒ¸</b>ì¸ì§€ <b>ì •ìƒ</b>ì¸ì§€ íŒë³„í•©ë‹ˆë‹¤.</p><br>
        <p>[model: mshenoda/roberta-spam]</p>

        <textarea id="spamText" placeholder="Example: Congratulations! You've won a $1,000 Walmart gift card. Click here to claim now!"></textarea>
        <br>
        <button onclick="checkSpam()" class="primary-btn">ë³´ì•ˆ ìŠ¤ìº” ì‹œì‘ ğŸš¨</button>

        <div id="result-box" class="spam-result-box">
            <span id="iconResult" style="font-size: 3em; display:block; margin-bottom:10px;"></span>
            <span id="labelResult" style="font-weight: bold;"></span>
            <span class="spam-score" id="scoreResult"></span>
            <p style="font-size: 0.8em; color: #666; margin-top: 10px;">(í™•ì‹ ë„)</p>
        </div>
    </div>

    <script>
        async function checkSpam() {
            const text = document.getElementById('spamText').value;
            if(!text) { alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }

            const btn = document.querySelector('button');
            btn.innerText = "ìŠ¤ìº” ì¤‘... ğŸ”";
            btn.disabled = true;

            try {
                const response = await fetch("{% url 'richman:spam' %}", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-CSRFToken': '{{ csrf_token }}',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: `text=${encodeURIComponent(text)}`
                });

                const data = await response.json();
                const box = document.getElementById('result-box');
                
                box.className = 'spam-result-box ' + data.label; 
                
                document.getElementById('labelResult').innerText = data.korean_label;
                document.getElementById('scoreResult').innerText = data.score + "%";

                if(data.label === 'spam') {
                    document.getElementById('iconResult').innerText = "ğŸ’€";
                } else {
                    document.getElementById('iconResult').innerText = "ğŸ›¡ï¸";
                }

                box.style.display = 'block';

            } catch (e) {
                alert("ì—ëŸ¬ ë°œìƒ: " + e.message);
            } finally {
                btn.innerText = "ë³´ì•ˆ ìŠ¤ìº” ì‹œì‘ ğŸš¨";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>