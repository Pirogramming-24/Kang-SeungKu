{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Richman - í•µì‹¬ ì •ë³´ ì¶”ì¶œ (NER)</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>

    <a href="{% url 'richman:main' %}" class="back-link">â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>

    <div class="page-container">
        <h1>ğŸ” í•µì‹¬ ì •ë³´ ì¶”ì¶œ (NER)</h1>
        <p>ê¸ˆìœµ ë‰´ìŠ¤ì—ì„œ <b>íšŒì‚¬(ORG), ì¸ë¬¼(PER), ì¥ì†Œ(LOC)</b>ë¥¼ ìë™ìœ¼ë¡œ ì°¾ì•„ëƒ…ë‹ˆë‹¤.</p><br>
        <p>[model : dbmdz/bert-large-cased-finetuned-conll03-english]</p>

        <textarea id="newsText" placeholder="Example: Apple CEO Tim Cook visited the new store in Shanghai yesterday."></textarea>
        <br>
        <button onclick="extractEntities()" class="primary-btn">ì •ë³´ ì¶”ì¶œ ì‹œì‘ ğŸ•µï¸â€â™‚ï¸</button>

        <div id="result-area" class="result-area">
            
            <div class="entity-box">
                <h3>ğŸ¢ íšŒì‚¬ / ì¡°ì§ (ORG)</h3>
                <div id="org-list"></div>
            </div>

            <div class="entity-box">
                <h3>ğŸ‘¤ í•µì‹¬ ì¸ë¬¼ (PER)</h3>
                <div id="per-list"></div>
            </div>

            <div class="entity-box">
                <h3>ğŸŒ ì¥ì†Œ / ìœ„ì¹˜ (LOC)</h3>
                <div id="loc-list"></div>
            </div>

        </div>
    </div>

    <script>
        async function extractEntities() {
            const text = document.getElementById('newsText').value;
            if(!text) { alert("ë¬¸ì¥ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }

            const btn = document.querySelector('button');
            btn.innerText = "ë¶„ì„ ì¤‘... ğŸ•µï¸â€â™‚ï¸";
            btn.disabled = true;

            try {
                const response = await fetch("{% url 'richman:ner' %}", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-CSRFToken': '{{ csrf_token }}',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: `text=${encodeURIComponent(text)}`
                });

                const data = await response.json();

                // ê²°ê³¼ ë¿Œë¦¬ê¸° í•¨ìˆ˜ (ì½”ë“œ ì¤‘ë³µ ë°©ì§€)
                renderTags('org-list', data.ORG, 'ORG');
                renderTags('per-list', data.PER, 'PER');
                renderTags('loc-list', data.LOC, 'LOC');

                document.getElementById('result-area').style.display = 'block';

            } catch (e) {
                alert("ì—ëŸ¬ ë°œìƒ: " + e.message);
            } finally {
                btn.innerText = "ì •ë³´ ì¶”ì¶œ ì‹œì‘ ğŸ•µï¸â€â™‚ï¸";
                btn.disabled = false;
            }
        }

        // íƒœê·¸ë¥¼ ë§Œë“¤ì–´ì„œ HTMLì— ë„£ì–´ì£¼ëŠ” ë„ìš°ë¯¸ í•¨ìˆ˜
        function renderTags(elementId, items, type) {
            const container = document.getElementById(elementId);
            container.innerHTML = ""; // ì´ˆê¸°í™”

            if (!items || items.length === 0) {
                container.innerHTML = '<span class="no-data">ë°œê²¬ëœ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</span>';
                return;
            }

            items.forEach(item => {
                const span = document.createElement('span');
                span.className = `tag ${type}`; // ì˜ˆ: tag ORG
                span.innerText = item;
                container.appendChild(span);
            });
        }
    </script>
</body>
</html>