{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Richman - ê¸€ë¡œë²Œ ë‰´ìŠ¤ ë¦¬í¬íŠ¸</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>

    <a href="{% url 'richman:main' %}" class="back-link">â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>

    <div class="page-container">
        <h1>ğŸ“° ê¸€ë¡œë²Œ ë‰´ìŠ¤ ë¦¬í¬íŠ¸ (Pipeline)</h1>
        <p>ì˜ì–´ ë‰´ìŠ¤ë¥¼ ì…ë ¥í•˜ë©´ <b>[ë²ˆì—­ ëª¨ë¸]</b>ê³¼ <b>[ìš”ì•½ ëª¨ë¸]</b>ì´ í˜‘ë ¥í•˜ì—¬ ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.</p>

        <textarea id="newsText" placeholder="Long English news article here..."></textarea>
        <br>
        <button onclick="generateReport()" class="primary-btn">ë¦¬í¬íŠ¸ ìƒì„± ì‹œì‘ âš¡</button>

        <div id="loading" class="loading-msg">
            AI ëª¨ë¸ 2ê°œê°€ ì—°ì‚° ì¤‘ì…ë‹ˆë‹¤... (ìµœì´ˆ ì‹¤í–‰ ì‹œ 1~2ë¶„ ì†Œìš”) â³
        </div>

        <div id="result-area" class="result-area">
            <div class="pipeline-box">
                <div class="step">
                    <h3>ğŸ‡ºğŸ‡¸ 1. ì›ë³¸ (Input)</h3>
                    <p id="originalText" style="font-size: 0.9em; color: #666;"></p>
                </div>
                
                <div class="arrow">â†’</div>
                
                <div class="step">
                    <h3>ğŸ‡°ğŸ‡· 2. ë²ˆì—­ (Model A)</h3>
                    <p id="translatedText" style="font-size: 0.9em;"></p>
                </div>
                
                <div class="arrow">â†’</div>
                
                <div class="step highlight">
                    <h3>ğŸ“ 3. ìš”ì•½ (Model B)</h3>
                    <p id="summaryText"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function generateReport() {
            const text = document.getElementById('newsText').value;
            if(!text) { alert("ë‰´ìŠ¤ë¥¼ ë„£ì–´ì£¼ì„¸ìš” í˜•ë‹˜!"); return; }

            // UI ì œì–´
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result-area').style.display = 'none';
            document.querySelector('button').disabled = true;

            try {
                const response = await fetch("{% url 'richman:report' %}", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-CSRFToken': '{{ csrf_token }}',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: `text=${encodeURIComponent(text)}`
                });

                const data = await response.json();

                if(data.error) throw new Error(data.error);

                // ê²°ê³¼ ë¿Œë¦¬ê¸°
                document.getElementById('originalText').innerText = data.original;
                document.getElementById('translatedText').innerText = data.translated;
                document.getElementById('summaryText').innerText = data.summary;
                
                document.getElementById('result-area').style.display = 'block';

            } catch (e) {
                alert("ì—ëŸ¬ ë°œìƒ: " + e.message);
            } finally {
                document.getElementById('loading').style.display = 'none';
                document.querySelector('button').disabled = false;
            }
        }
    </script>
</body>
</html>