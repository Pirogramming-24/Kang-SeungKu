{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ì˜í™” ì¶”ì²œ</title>
    <link rel="stylesheet" href="{% static 'chatbot.css' %}">
    <link rel="stylesheet" href="{% static 'reset.css' %}">
</head>
<body>
    <div class="header">
        <div class="logo">
            <a href="{% url 'movie_list' %}"><h1>my<span style="color: red;">Movie</span>reviews</h1></a>
        </div>
        <a href="{% url 'movie_create' %}"><h3>Add a New review</h3></a>
    </div>
    <hr>
    
    <div class="chat-container">
        <div class="chat-header">
            <h2 class="chat-title"><span style="color:red">AI</span> ì˜í™” ì¶”ì²œ</h2>
            <p class="chat-subtitle">í˜•ë‹˜ì˜ ì»¬ë ‰ì…˜ì„ ë¶„ì„í•´ ë”± ë§ëŠ” ì˜í™”ë¥¼ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤.</p>
        </div>

        <div class="chat-window" id="chat-window">
            <div class="message bot">
                <div class="msg-sender">ì±—ë´‡</div>
                <div class="msg-bubble">
                    ì•ˆë…•í•˜ì„¸ìš” í˜•ë‹˜! ì°¾ìœ¼ì‹œëŠ” ì¥ë¥´ë‚˜ ë¶„ìœ„ê¸°ë¥¼ ë§ì”€í•´ì£¼ì‹œë©´ í˜•ë‹˜ì˜ ì»¬ë ‰ì…˜ ì•ˆì—ì„œ ìµœê³ ì˜ ì˜í™”ë¥¼ ì°¾ì•„ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
                </div>
            </div>
        </div>

        <div class="suggestion-chips">
            <button onclick="sendSuggestion('ì•¡ì…˜ ì˜í™” ì¶”ì²œí•´ì¤˜')">ğŸ”¥ ì•¡ì…˜ ì˜í™”</button>
            <button onclick="sendSuggestion('ê°ë™ì ì¸ ë“œë¼ë§ˆ ì¶”ì²œí•´ì¤˜')">ğŸ’§ ê°ë™ ë“œë¼ë§ˆ</button>
            <button onclick="sendSuggestion('í‰ì  ë†’ì€ ì˜í™” ë­ì•¼?')">â­ ê³ í‰ì  ì˜í™”</button>
        </div>

        <div class="input-area">
            <input type="text" id="user-input" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." onkeypress="handleKeyPress(event)">
            <button onclick="sendMessage()" class="btn-send">ì „ì†¡</button>
        </div>
    </div>

    <script>
        function handleKeyPress(e) {
            if (e.key === 'Enter') sendMessage();
        }

        function sendSuggestion(text) {
            document.getElementById('user-input').value = text;
            sendMessage();
        }

        function sendMessage() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            if (!message) return;

            addMessage('user', message);
            input.value = '';
            
            // [ìˆ˜ì •ë¨] ë¡œë”© ë©”ì‹œì§€ë„ 'ì±—ë´‡'ìœ¼ë¡œ í‘œì‹œ
            const loadingId = addMessage('bot', 'ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì‹­ì‹œì˜¤ í˜•ë‹˜...');

            fetch("{% url 'chatbot' %}", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ message: message })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById(loadingId).remove();
                addMessage('bot', data.response);
            })
            .catch(error => {
                document.getElementById(loadingId).innerText = "ì£„ì†¡í•©ë‹ˆë‹¤ í˜•ë‹˜. í„°ë¯¸ë„ ë¡œê·¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.";
            });
        }

        function addMessage(sender, text) {
            const chatWindow = document.getElementById('chat-window');
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${sender}`;
            msgDiv.id = 'msg-' + Date.now();
            
            // [ìˆ˜ì •ë¨] ì—¬ê¸°ì„œ 'ì±—ë´‡'ì´ë¼ëŠ” ì´ë¦„ì„ ì‚¬ìš©í•©ë‹ˆë‹¤
            const senderName = sender === 'bot' ? 'ì±—ë´‡' : 'ë‚˜';
            
            msgDiv.innerHTML = `
                <div class="msg-sender">${senderName}</div>
                <div class="msg-bubble">${text.replace(/\n/g, '<br>')}</div>
            `;
            
            chatWindow.appendChild(msgDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;
            return msgDiv.id;
        }
    </script>
</body>
</html>